<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat com Gemini</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; display: flex; justify-content: center; height: 100vh; margin: 0; }
        .chat-container { width: 100%; max-width: 600px; background: white; display: flex; flex-direction: column; box-shadow: 0 4px 20px rgba(0,0,0,0.1); height: 100vh; }
        
        /* Área de Configuração da Chave */
        .config-area { padding: 15px; background: #1a73e8; color: white; }
        .config-area input { width: 95%; padding: 8px; border-radius: 4px; border: none; margin-top: 5px; font-family: monospace; }
        .config-area label { font-size: 0.9rem; font-weight: bold; }

        /* Área das Mensagens */
        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        
        /* Balões de fala */
        .message { padding: 12px 18px; border-radius: 18px; max-width: 80%; line-height: 1.5; font-size: 15px; }
        .user { align-self: flex-end; background-color: #1a73e8; color: white; border-bottom-right-radius: 4px; }
        .ai { align-self: flex-start; background-color: #e8f0fe; color: #1f1f1f; border-bottom-left-radius: 4px; }
        .error { background-color: #ffebee; color: #c62828; align-self: center; border: 1px solid #ef9a9a; }

        /* Área de Digitação */
        .input-area { padding: 20px; border-top: 1px solid #eee; display: flex; gap: 10px; background: white; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 25px; outline: none; transition: border 0.3s; }
        input[type="text"]:focus { border-color: #1a73e8; }
        button { padding: 10px 25px; background: #1a73e8; color: white; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; transition: background 0.2s; }
        button:hover { background-color: #1557b0; }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

    <div class="chat-container">
        <div class="config-area">
            <label>✨ Coloque sua API Key do Google Gemini aqui:</label>
            <input type="password" id="apiKey" placeholder="Cole sua chave aqui..." autocomplete="off">
        </div>

        <div id="messages">
            <div class="message ai">Olá! Eu sou uma IA baseada no Gemini. Configure sua chave acima e diga oi!</div>
        </div>

        <div class="input-area">
            <input type="text" id="userInput" placeholder="Digite sua mensagem...">
            <button onclick="sendMessage()" id="sendBtn">Enviar</button>
        </div>
    </div>

    <script>
        // Função para converter texto para Markdown simples (opcional, para quebras de linha)
        function formatText(text) {
            return text.replace(/\n/g, '<br>');
        }

        async function sendMessage() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const userInput = document.getElementById('userInput');
            const messagesDiv = document.getElementById('messages');
            const sendBtn = document.getElementById('sendBtn');

            if (!apiKey) {
                alert("Ops! Você precisa colar sua API Key do Gemini na barra azul lá em cima.");
                return;
            }
            if (!userInput.value) return;

            // 1. Mostrar mensagem do usuário na tela
            const userText = userInput.value;
            addMessage(userText, 'user');
            userInput.value = '';
            
            // Bloquear botão e mostrar carregando
            sendBtn.disabled = true;
            sendBtn.innerText = 'Pensando...';

            try {
                // 2. CONFIGURAÇÃO ESPECÍFICA DO GEMINI
                // Usando o modelo 'gemini-1.5-flash' (rápido e eficiente)
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: userText }]
                        }]
                    })
                });

                const data = await response.json();

                // Verificar erros da API
                if (data.error) {
                    throw new Error(data.error.message);
                }

                // 3. Pegar a resposta do Gemini e mostrar
                // O caminho da resposta no JSON do Google é diferente da OpenAI
                const aiResponse = data.candidates[0].content.parts[0].text;
                addMessage(aiResponse, 'ai');

            } catch (error) {
                addMessage("Erro: " + error.message, 'error');
            }

            // Reativar botão
            sendBtn.disabled = false;
            sendBtn.innerText = 'Enviar';
        }

        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('messages');
            const div = document.createElement('div');
            div.classList.add('message', sender);
            
            // Se for IA, permite formatação HTML básica (quebras de linha), se for usuário, texto puro
            if (sender === 'ai') {
                div.innerHTML = formatText(text);
            } else {
                div.innerText = text;
            }
            
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Rolar para o final
        }

        // Permitir enviar com Enter
        document.getElementById("userInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });
    </script>

</body>
</html>
